<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>증여세 계산기</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .gift-tax-container { max-width: 600px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.07); padding: 32px 28px; }
        .gift-tax-title { font-size: 1.6em; font-weight: bold; margin-bottom: 24px; color: #17506b; text-align:center; }
        .gift-tax-form label { font-weight: 500; margin-bottom: 6px; display:block; }
        .gift-tax-form input, .gift-tax-form select { width: 100%; padding: 10px; margin-bottom: 18px; border-radius: 5px; border: 1px solid #ccc; font-size: 15px; }
        .gift-tax-form button { width: 100%; background: #17506b; color: #fff; border: none; border-radius: 5px; padding: 13px; font-size: 17px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .gift-tax-form button:hover { background: #003366; }
        .result-box { background: #f8f9fa; border-radius: 6px; padding: 18px; margin-top: 18px; font-size: 1.1em; color: #0b4e7b; text-align:center; }
        .top-bar { display:flex; justify-content:flex-end; margin-bottom:18px; }
        .main-btn { background:#003366; color:#fff; border:none; border-radius:5px; padding:8px 18px; font-size:15px; font-weight:600; cursor:pointer; }
        .main-btn:hover { background:#17506b; }
    </style>
</head>
<body>
    <div class="gift-tax-container">
        <div class="top-bar">
            <a href="{{ url_for('main') }}" class="main-btn">메인으로</a>
        </div>
        <div class="gift-tax-title">증여세 계산기</div>
        <button id="show-info-btn" type="button" style="width:100%;background:#208e4c;color:#fff;font-weight:600;padding:10px 0;border-radius:6px;margin-bottom:18px;">증여세율·증여공제 보기</button>
        <div id="tax-info-modal" style="display:none;position:fixed;z-index:1000;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.35);">
            <div style="background:#fff;max-width:700px;margin:60px auto;padding:32px 28px;border-radius:10px;position:relative;">
                <button id="close-info-modal" style="position:absolute;top:18px;right:18px;font-size:1.5em;background:none;border:none;cursor:pointer;">×</button>
                <h3 style="margin-top:0;color:#17506b;">증여세 세율 및 증여 재산 공제액 <span style="font-size:0.7em;color:#888;">*2025년 기준</span></h3>
                <table style="width:100%;border-collapse:collapse;margin-bottom:18px;">
                    <thead><tr style="background:#2980b9;color:#fff;"><th>과세표준</th><th>세율</th><th>누진공제</th></tr></thead>
                    <tbody style="text-align:center;">
                        <tr><td>1억 이하</td><td>10%</td><td></td></tr>
                        <tr><td>1억 초과~5억 이하</td><td>20%</td><td>10,000,000원</td></tr>
                        <tr><td>5억 초과~10억 이하</td><td>30%</td><td>60,000,000원</td></tr>
                        <tr><td>10억 초과~30억 이하</td><td>40%</td><td>160,000,000원</td></tr>
                        <tr><td>30억 초과</td><td>50%</td><td>460,000,000원</td></tr>
                    </tbody>
                </table>
                <h4 style="margin-bottom:6px;">증여재산공제액</h4>
                <table style="width:100%;border-collapse:collapse;">
                    <thead><tr style="background:#2980b9;color:#fff;"><th>증여자와의 관계</th><th>증여재산공제액(10년간)</th></tr></thead>
                    <tbody style="text-align:center;">
                        <tr><td>배우자</td><td>6억원</td></tr>
                        <tr><td>직계존속(계부,계모 포함)</td><td>5천만원(미성년자 2천만원)</td></tr>
                        <tr><td>직계비속</td><td>5천만원</td></tr>
                        <tr><td>기타친족(6촌 이내 혈족, 4촌 이내 인척)</td><td>1천만원</td></tr>
                        <tr><td>그 외의 자</td><td>0원</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        <form class="gift-tax-form" id="giftTaxForm" onsubmit="return false;">
            <label>평가액(원)</label>
            <input type="text" id="appraisedValue" required pattern="[0-9,]*" placeholder="예: 100,000,000">
            <label>채무액(원)</label>
            <input type="text" id="debtValue" required pattern="[0-9,]*" placeholder="예: 20,000,000">
            <label>증여자와의 관계</label>
            <select id="relation">
                <option value="spouse">배우자</option>
                <option value="parent">직계존속(계부,계모 포함)</option>
                <option value="descendant">직계비속</option>
                <option value="relative">기타친족(6촌 이내 혈족, 4촌 이내 인척)</option>
                <option value="other">그 외의 자</option>
            </select>
            <label>공제액(원, 자동반영)</label>
            <input type="text" id="deduction" required pattern="[0-9,]*" placeholder="공제액 자동입력" readonly style="background:#f2f2f2;">
            <button type="submit">계산하기</button>
        </form>
        <div class="result-box" id="resultBox" style="display:none;"></div>
    </div>
    <script>
    // 증여세율/공제액 안내 모달
    document.getElementById('show-info-btn').onclick = function() {
        document.getElementById('tax-info-modal').style.display = 'block';
    };
    document.getElementById('close-info-modal').onclick = function() {
        document.getElementById('tax-info-modal').style.display = 'none';
    };

    // 3자리마다 콤마 자동 입력
    function addComma(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    function removeComma(str) {
        return str.replace(/,/g, '');
    }
    function setDeductionByRelation() {
        const deductionMap = {
            spouse: 600000000,
            parent: 50000000, // 미성년자 20000000은 별도 처리 필요
            descendant: 50000000,
            relative: 10000000,
            other: 0
        };
        const val = deductionMap[document.getElementById('relation').value] || 0;
        document.getElementById('deduction').value = addComma(val);
    }
    document.getElementById('relation').addEventListener('change', setDeductionByRelation);
    setDeductionByRelation();

    // 입력란에 3자리마다 콤마 자동
    ['appraisedValue','debtValue'].forEach(id => {
        const el = document.getElementById(id);
        el.addEventListener('input', function(e) {
            let val = removeComma(this.value);
            if (val) this.value = addComma(Number(val));
        });
    });

    document.getElementById('giftTaxForm').addEventListener('submit', function() {
        const appraisedValue = parseInt(removeComma(document.getElementById('appraisedValue').value)) || 0;
        const debtValue = parseInt(removeComma(document.getElementById('debtValue').value)) || 0;
        const deduction = parseInt(removeComma(document.getElementById('deduction').value)) || 0;
        const taxable = Math.max(appraisedValue - debtValue - deduction, 0);

        // 누진공제표 (원 단위)
        const brackets = [
            { limit: 100000000, rate: 0.1, minus: 0 },
            { limit: 500000000, rate: 0.2, minus: 10000000 },
            { limit: 1000000000, rate: 0.3, minus: 60000000 },
            { limit: 3000000000, rate: 0.4, minus: 160000000 },
            { limit: Infinity, rate: 0.5, minus: 460000000 }
        ];
        let tax = 0, rate = 0, minus = 0;
        for (let i = 0; i < brackets.length; i++) {
            if (taxable <= brackets[i].limit) {
                rate = brackets[i].rate;
                minus = brackets[i].minus;
                break;
            }
        }
        tax = Math.floor(taxable * rate - minus);
        if (tax < 0) tax = 0;

        const resultBox = document.getElementById('resultBox');
        resultBox.style.display = 'block';
        resultBox.innerHTML = `과세표준: <b>${addComma(taxable)}원</b><br>증여세: <b>${addComma(tax)}원</b>`;
    });
    </script>
</body>
</html>
