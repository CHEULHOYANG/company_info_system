<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>종합소득세 계산기</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .income-tax-container { max-width: 700px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.07); padding: 32px 28px; }
        .income-tax-title { font-size: 1.6em; font-weight: bold; margin-bottom: 24px; color: #17506b; text-align:center; }
        .income-tax-form label { font-weight: 500; margin-bottom: 6px; display:block; }
        .income-tax-form input, .income-tax-form select { width: 100%; padding: 10px; margin-bottom: 18px; border-radius: 5px; border: 1px solid #ccc; font-size: 15px; }
        .income-tax-form button { width: 100%; background: #17506b; color: #fff; border: none; border-radius: 5px; padding: 13px; font-size: 17px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .income-tax-form button:hover { background: #003366; }
        .result-box { background: #f8f9fa; border-radius: 6px; padding: 18px; margin-top: 18px; font-size: 1.1em; color: #0b4e7b; text-align:center; }
        .top-bar { display:flex; justify-content:flex-end; margin-bottom:18px; }
        .main-btn { background:#003366; color:#fff; border:none; border-radius:5px; padding:8px 18px; font-size:15px; font-weight:600; cursor:pointer; }
        .main-btn:hover { background:#17506b; }
        .tax-rate-btns { display:flex; gap:10px; justify-content:center; margin-bottom:18px; }
        .tax-rate-btn { background:#208e4c; color:#fff; border:none; border-radius:5px; padding:8px 18px; font-size:15px; font-weight:600; cursor:pointer; }
        .tax-rate-btn:hover { background:#003366; }
    </style>
</head>
<body>
    <div class="income-tax-container">
        <div class="top-bar">
            <a href="{{ url_for('main') }}" class="main-btn">메인으로</a>
        </div>
        <div class="income-tax-title">종합소득세 계산기</div>
        <div class="tax-rate-btns">
            <button type="button" class="tax-rate-btn" onclick="showIncomeTaxRate()">종합소득세율 보기</button>
        </div>
        <form class="income-tax-form" id="incomeTaxForm" onsubmit="return false;">
            <label>종합소득합계(원)</label>
            <input type="text" id="totalIncome" required pattern="[0-9,]*" placeholder="예: 50,000,000">
            <div style="font-size:0.95em;color:#888;margin-bottom:10px;">사업소득, 임대소득 등 종합소득 합계<br>근로, 이자, 배당 소득 합산은 세무전문가와 상담</div>
            <label>필요경비 비율(%)</label>
            <input type="number" id="expenseRate" min="0" max="100" value="0" required placeholder="예: 10">
            <div style="font-size:0.95em;color:#888;margin-bottom:10px;">주요경비: 상품 구입비용, 임차료, 인건비 등</div>
            <label>인적공제 합계(원)</label>
            <input type="text" id="personalDeduction" value="1,500,000" required pattern="[0-9,]*" placeholder="예: 1,500,000">
            <div style="font-size:0.95em;color:#888;margin-bottom:10px;">본인/부양가족 등 인적공제 총액</div>
            <label>국민연금 등 합계(원)</label>
            <input type="text" id="pensionDeduction" value="0" required pattern="[0-9,]*" placeholder="예: 2,000,000">
            <div style="font-size:0.95em;color:#888;margin-bottom:10px;">국민연금, 노란우산공제 등 해당연도에 불입한 금액</div>
            <label>개인연금저축(2000.12.31 이전 가입분, 원)</label>
            <input type="text" id="oldPension" value="0" required pattern="[0-9,]*" placeholder="예: 1,000,000">
            <div style="font-size:0.95em;color:#888;margin-bottom:10px;">Min(개인연금저축불입액×40%, 72만원)</div>
            <label>자녀세액공제 대상 인원(명)</label>
            <input type="number" id="childCount" min="0" value="0" required placeholder="예: 2">
            <div style="font-size:0.95em;color:#888;margin-bottom:10px;">*소득금액이 100만원 이하인 만 6세 이상 만 20세 이하 자녀</div>
            <label>연금저축 불입금액(2001.1.1 이후 가입분, 원)</label>
            <input type="text" id="newPension" value="0" required pattern="[0-9,]*" placeholder="예: 2,000,000">
            <div style="font-size:0.95em;color:#888;margin-bottom:10px;">세액공제대상 연금저축(연간최대 600,000원), 퇴직연금 IRP(연간최대 300,000원)</div>
            <button type="submit">계산하기</button>
        </form>
        <div class="result-box" id="resultBox" style="display:none;"></div>
    </div>
    <!-- 종합소득세율 모달 -->
    <div id="incomeTaxRateModal" style="display:none;position:fixed;z-index:1000;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.35);">
        <div style="background:#fff;max-width:700px;margin:60px auto;padding:32px 28px;border-radius:10px;position:relative;">
            <button id="closeIncomeTaxRateModal" style="position:absolute;top:18px;right:18px;font-size:1.5em;background:none;border:none;cursor:pointer;">×</button>
            <div id="incomeTaxRateContent"></div>
        </div>
    </div>
    <script>
    // 3자리 콤마
    function addComma(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    function removeComma(str) {
        return str.replace(/,/g, '');
    }
    // 입력란 콤마 자동
    ['totalIncome','personalDeduction','pensionDeduction','oldPension','newPension'].forEach(id => {
        const el = document.getElementById(id);
        el.addEventListener('input', function(e) {
            let val = removeComma(this.value);
            if (val) this.value = addComma(Number(val));
        });
    });
    // 세율 안내 모달
    function showIncomeTaxRate() {
        const modal = document.getElementById('incomeTaxRateModal');
        const content = document.getElementById('incomeTaxRateContent');
        content.innerHTML = `<h3 style='color:#17506b;'>종합소득세율</h3><table style='width:100%;border-collapse:collapse;text-align:center;'><thead><tr style='background:#2980b9;color:#fff;'><th>과세표준</th><th>세율</th><th>누진공제</th></tr></thead><tbody><tr><td>1,400만원 이하</td><td>6%</td><td></td></tr><tr><td>5,000만원 이하</td><td>15%</td><td>1,260,000원</td></tr><tr><td>8,800만원 이하</td><td>24%</td><td>5,760,000원</td></tr><tr><td>1억5천만원 이하</td><td>35%</td><td>14,460,000원</td></tr><tr><td>3억원 이하</td><td>38%</td><td>19,460,000원</td></tr><tr><td>5억원 이하</td><td>40%</td><td>25,460,000원</td></tr><tr><td>10억원 이하</td><td>42%</td><td>35,460,000원</td></tr><tr><td>10억원 초과</td><td>45%</td><td>65,460,000원</td></tr></tbody></table>`;
        modal.style.display = 'block';
    }
    document.getElementById('closeIncomeTaxRateModal').onclick = function() {
        document.getElementById('incomeTaxRateModal').style.display = 'none';
    };
    // 계산
    document.getElementById('incomeTaxForm').addEventListener('submit', function() {
        const totalIncome = parseInt(removeComma(document.getElementById('totalIncome').value)) || 0;
        const expenseRate = parseFloat(document.getElementById('expenseRate').value) || 0;
        const personalDeduction = parseInt(removeComma(document.getElementById('personalDeduction').value)) || 0;
        const pensionDeduction = parseInt(removeComma(document.getElementById('pensionDeduction').value)) || 0;
        const oldPension = parseInt(removeComma(document.getElementById('oldPension').value)) || 0;
        const childCount = parseInt(document.getElementById('childCount').value) || 0;
        const newPension = parseInt(removeComma(document.getElementById('newPension').value)) || 0;

        // 필요경비
        const expense = Math.floor(totalIncome * expenseRate / 100);
        // 소득금액
        const incomeAmount = totalIncome - expense;
        // 개인연금저축공제(2000.12.31 이전): 불입액×0.4, 최대 720,000원
        const oldPensionDeduct = Math.min(Math.floor(oldPension * 0.4), 720000);
        // 과세표준
        const taxBase = Math.max(incomeAmount - personalDeduction - pensionDeduction - oldPensionDeduct, 0);

        // 누진공제표
        const brackets = [
            { limit: 14000000, rate: 0.06, minus: 0 },
            { limit: 50000000, rate: 0.15, minus: 1260000 },
            { limit: 88000000, rate: 0.24, minus: 5760000 },
            { limit: 150000000, rate: 0.35, minus: 14460000 },
            { limit: 300000000, rate: 0.38, minus: 19460000 },
            { limit: 500000000, rate: 0.40, minus: 25460000 },
            { limit: 1000000000, rate: 0.42, minus: 35460000 },
            { limit: Infinity, rate: 0.45, minus: 65460000 }
        ];
        let tax = 0, rate = 0, minus = 0;
        for (let i = 0; i < brackets.length; i++) {
            if (taxBase <= brackets[i].limit) {
                rate = brackets[i].rate;
                minus = brackets[i].minus;
                break;
            }
        }
        let calcTax = Math.floor(taxBase * rate - minus);
        if (calcTax < 0) calcTax = 0;

        // 자녀세액공제(1인당 150,000원)
        const childCredit = childCount * 150000;
        // 연금저축불입액 세액공제(최대 600,000원)
        const newPensionCredit = Math.min(Math.floor(newPension * 0.15), 600000);

        // 최종 산출세액
        const finalTax = Math.max(calcTax - childCredit - newPensionCredit, 0);

        const resultBox = document.getElementById('resultBox');
        resultBox.style.display = 'block';
        resultBox.innerHTML =
            `필요경비: <b>${addComma(expense)}원</b><br>`+
            `소득금액: <b>${addComma(incomeAmount)}원</b><br>`+
            `개인연금저축공제: <b>${addComma(oldPensionDeduct)}원</b><br>`+
            `과세표준: <b>${addComma(taxBase)}원</b><br>`+
            `산출세액: <b>${addComma(calcTax)}원</b><br>`+
            `자녀세액공제: <b>${addComma(childCredit)}원</b><br>`+
            `연금저축불입공제: <b>${addComma(newPensionCredit)}원</b><br>`+
            `<hr style='margin:10px 0;'>최종 종합소득세(예상): <b style='color:#17506b;font-size:1.2em;'>${addComma(finalTax)}원</b>`;
    });
    </script>
</body>
</html>
