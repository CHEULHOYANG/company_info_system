<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>퇴직금 계산기</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container-retire { 
            max-width: 800px; 
            margin: 40px auto; 
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.3);
            padding: 40px;
            position: relative;
            overflow: hidden;
        }
        .container-retire::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
            background-size: 400% 400%;
            animation: gradient 3s ease infinite;
        }
        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .retire-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 30px; 
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        .retire-title { 
            color: #2c3e50; 
            font-size: 2.2em; 
            font-weight: 700; 
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .retire-tax-btn { 
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff; 
            font-weight: 600; 
            padding: 12px 24px; 
            border-radius: 12px; 
            border: none; 
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        .retire-tax-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        .retire-form { 
            background: rgba(248, 250, 252, 0.8);
            backdrop-filter: blur(10px);
            padding: 30px; 
            border-radius: 16px; 
            border: 1px solid rgba(255,255,255,0.2);
        }
        .retire-btn { 
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff; 
            font-weight: 600; 
            padding: 14px 32px; 
            border-radius: 12px; 
            border: none; 
            font-size: 1.1em; 
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            width: 100%;
            margin-top: 20px;
        }
        .retire-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.05em;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .date-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .date-inputs select {
            flex: 1;
        }
        .radio-group {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .radio-group label {
            display: flex;
            align-items: center;
            font-weight: 400 !important;
            margin-bottom: 0 !important;
            cursor: pointer;
        }
        .radio-group input[type="radio"] {
            margin-right: 8px;
            width: auto;
        }
        .exec-options {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            border-left: 4px solid #667eea;
        }
        .help-text {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
            line-height: 1.4;
        }
        @media (max-width: 768px) {
            .container-retire { 
                margin: 20px auto;
                padding: 25px; 
            }
            .retire-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            .retire-title {
                font-size: 1.8em;
            }
            .date-inputs {
                flex-direction: column;
                gap: 10px;
            }
            .radio-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
<div class="container-retire">
    <div class="retire-header">
        <div class="retire-title">퇴직금 계산기</div>
        <div style="display:flex;gap:8px;align-items:center;">
            <a href="/main" class="retire-tax-btn" style="text-decoration:none;">메인으로</a>
            <button type="button" id="showRetireTaxRateBtn" class="retire-tax-btn">퇴직소득세율표 보기</button>
        </div>
    </div>
    <form id="retirementForm" class="retire-form" autocomplete="off">
        <div class="form-group">
            <label>입사일</label>
            <div class="date-inputs">
                <select id="joinYear"></select>
                <select id="joinMonth"></select>
                <select id="joinDay"></select>
            </div>
        </div>
        
        <div class="form-group">
            <label>퇴사일</label>
            <div class="date-inputs">
                <select id="leaveYear"></select>
                <select id="leaveMonth"></select>
                <select id="leaveDay"></select>
            </div>
        </div>
        
        <div class="form-group">
            <label>퇴직 직전 1년간 총 급여</label>
            <input type="text" id="last1ySalary" placeholder="예: 200,000,000" required pattern="[0-9,]*" inputmode="numeric" autocomplete="off">
            <div class="help-text">퇴직금 계산의 기준이 되는 금액입니다</div>
        </div>
        
        <div class="form-group">
            <label>퇴직 직전 3년간 총 급여 (임원 한도용)</label>
            <input type="text" id="last3ySalary" placeholder="예: 600,000,000" pattern="[0-9,]*" inputmode="numeric" autocomplete="off">
            <div class="help-text">임원/대표일 때만 입력, 한도 계산에 사용됩니다</div>
        </div>
        
        <div class="form-group">
            <label>임원 이상 여부</label>
            <div class="radio-group">
                <label><input type="radio" name="executive" value="no" checked> 일반 직원</label>
                <label><input type="radio" name="executive" value="yes"> 임원/대표</label>
            </div>
        </div>
        
        <div id="execOptions" class="exec-options" style="display:none;">
            <div class="form-group">
                <label>임원 퇴직소득 한도 배수</label>
                <div style="display:flex;align-items:center;gap:10px;">
                    <input type="number" id="execMultiplier" min="0.1" max="10" step="0.1" value="2" style="width:100px;" inputmode="decimal" autocomplete="off">
                    <span style="font-weight:600;">배수</span>
                </div>
                <div class="help-text">
                    ? 2011년 이전: 정관에서 정한 배수<br>
                    ? 2012~2019년: 3배수<br>
                    ? 2020년 이후: 2배수<br>
                    ? 소수점 입력 가능 (예: 2.5배)
                </div>
            </div>
            
            <div class="form-group">
                <label>직전 3년 급여 총액 (임원용)</label>
                <input type="text" id="exec3ySalary" placeholder="예: 300,000,000" pattern="[0-9,]*">
                <div class="help-text">임원일 때만 입력, 평균임금은 직전 3년 총액을 일수 기준으로 나눈 값 (직전3년총액÷1080)</div>
            </div>
        </div>
        
        <button type="submit" class="retire-btn">계산하기</button>
    </form>
    
    <div id="retireResult" style="display:none;background:linear-gradient(135deg, #e8f5e8, #f0fff0);padding:25px;border-radius:16px;margin-top:25px;border-left:4px solid #28a745;"></div>
    
    <div style="background:rgba(108, 117, 125, 0.1);border-radius:12px;padding:20px;margin-top:25px;">
        <h4 style="color:#495057;margin-bottom:15px;">? 유의 사항</h4>
        <div style="font-size:0.95em;color:#6c757d;line-height:1.6;">
            <p><strong>1.</strong> 퇴직금은 1년 이상 재직한 근로자에 한해 지급되며, 재직기간 1년당 30일분의 평균임금이 지급됩니다.</p>
            <p><strong>2.</strong> "평균임금"이란 발생 사유일 이전 3개월 동안 지급된 임금 총액을 그 기간의 총일수로 나눈 금액입니다.</p>
            <p><strong>3.</strong> 임원의 경우 별도의 한도 배수가 적용되며, 이는 정관이나 관련 규정에 따라 달라질 수 있습니다.</p>
            <p><strong>4.</strong> 위 계산결과는 근로자퇴직급여 보장법상 기준이며, 실제 지급액과 차이가 있을 수 있습니다.</p>
        </div>
    </div>
    <!-- 퇴직소득세율 안내 모달 -->
    <div id="retireTaxRateModal" style="display:none;position:fixed;z-index:1000;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);backdrop-filter:blur(5px);">
        <div style="background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);max-width:700px;margin:60px auto;padding:32px 28px;border-radius:20px;position:relative;box-shadow:0 20px 50px rgba(0,0,0,0.2);">
            <button id="closeRetireTaxRateModal" style="position:absolute;top:18px;right:18px;font-size:1.5em;background:none;border:none;cursor:pointer;color:#6c757d;width:40px;height:40px;border-radius:50%;transition:all 0.3s ease;">×</button>
            <h3 style="color:#2c3e50;font-size:1.5em;margin-bottom:20px;text-align:center;">퇴직소득세율표</h3>
            <div style="overflow-x:auto;">
                <table style="width:100%;border-collapse:collapse;text-align:center;background:rgba(255,255,255,0.9);border-radius:12px;overflow:hidden;">
                    <thead>
                        <tr style="background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;">
                            <th style="padding:15px;font-weight:600;">과세표준</th>
                            <th style="padding:15px;font-weight:600;">세율</th>
                            <th style="padding:15px;font-weight:600;">누진공제</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom:1px solid rgba(0,0,0,0.1);"><td style="padding:12px;">1,200만원 이하</td><td style="padding:12px;font-weight:600;color:#28a745;">6%</td><td style="padding:12px;">0</td></tr>
                        <tr style="border-bottom:1px solid rgba(0,0,0,0.1);"><td style="padding:12px;">4,600만원 이하</td><td style="padding:12px;font-weight:600;color:#fd7e14;">15%</td><td style="padding:12px;">108만원</td></tr>
                        <tr style="border-bottom:1px solid rgba(0,0,0,0.1);"><td style="padding:12px;">8,800만원 이하</td><td style="padding:12px;font-weight:600;color:#e83e8c;">24%</td><td style="padding:12px;">522만원</td></tr>
                        <tr style="border-bottom:1px solid rgba(0,0,0,0.1);"><td style="padding:12px;">1억5천만원 이하</td><td style="padding:12px;font-weight:600;color:#6f42c1;">35%</td><td style="padding:12px;">1,490만원</td></tr>
                        <tr style="border-bottom:1px solid rgba(0,0,0,0.1);"><td style="padding:12px;">3억원 이하</td><td style="padding:12px;font-weight:600;color:#dc3545;">38%</td><td style="padding:12px;">1,940만원</td></tr>
                        <tr style="border-bottom:1px solid rgba(0,0,0,0.1);"><td style="padding:12px;">5억원 이하</td><td style="padding:12px;font-weight:600;color:#dc3545;">40%</td><td style="padding:12px;">2,540만원</td></tr>
                        <tr><td style="padding:12px;">5억원 초과</td><td style="padding:12px;font-weight:600;color:#dc3545;">42%</td><td style="padding:12px;">3,540만원</td></tr>
                    </tbody>
                </table>
            </div>
            <div style="font-size:0.95em;color:#6c757d;margin-top:15px;text-align:center;background:rgba(108, 117, 125, 0.1);padding:10px;border-radius:8px;">
                ?? 실제 세율은 법령 변경 및 개인 상황에 따라 다를 수 있습니다.
            </div>
        </div>
    </div>
</div>
<script>
// 입력란 천단위 콤마 자동 적용 및 숫자만 허용
function setCommaInput(id, allowFloat=false) {
    const el = document.getElementById(id);
    if(!el) return;
    el.addEventListener('input', function(e) {
        let val = el.value.replace(/[^\d.]/g, '');
        // 소수점 1개만 허용
        if(allowFloat) {
            const parts = val.split('.');
            if(parts.length>2) val = parts[0]+'.'+parts.slice(1).join('');
            // 소수점 앞부분만 콤마
            if(parts.length>1) {
                el.value = addComma(parts[0]) + '.' + parts[1];
                return;
            }
        } else {
            val = val.replace(/\./g, '');
        }
        if(val) el.value = addComma(val);
        else el.value = '';
    });
}

// 날짜 셀렉트 박스 자동 생성
function fillDateSelect(id, start, end, val) {
    const sel = document.getElementById(id);
    for(let i=start;i<=end;i++) {
        const opt = document.createElement('option');
        opt.value = i;
        opt.text = i;
        if(i===val) opt.selected = true;
        sel.appendChild(opt);
    }
}

const today = new Date();
fillDateSelect('joinYear', 1980, today.getFullYear(), today.getFullYear()-1);
fillDateSelect('joinMonth', 1, 12, 1);
fillDateSelect('joinDay', 1, 31, 1);
fillDateSelect('leaveYear', 1980, today.getFullYear(), today.getFullYear());
fillDateSelect('leaveMonth', 1, 12, today.getMonth()+1);
fillDateSelect('leaveDay', 1, 31, today.getDate());

// 임원 여부에 따라 한도 기준 노출
const execRadios = document.getElementsByName('executive');
for(const r of execRadios) {
    r.onchange = function() {
        const execOptions = document.getElementById('execOptions');
        execOptions.style.display = (this.value==='yes')?'block':'none';
        
        // 애니메이션 효과
        if(this.value==='yes') {
            execOptions.style.opacity = '0';
            execOptions.style.transform = 'translateY(-10px)';
            setTimeout(() => {
                execOptions.style.transition = 'all 0.3s ease';
                execOptions.style.opacity = '1';
                execOptions.style.transform = 'translateY(0)';
            }, 50);
        }
    }
}

// 콤마 처리
function addComma(x) { return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); }
function removeComma(x) { return x.replace(/,/g,""); }

// 입력란에 콤마 적용 (요소가 모두 렌더된 이후에 호출)
setCommaInput('last1ySalary');
setCommaInput('last3ySalary');
setCommaInput('exec3ySalary');

// 퇴직금 계산 함수
function calcRetirementPay(join, leave, last1ySalary, last3ySalary, isExec, execMultiplier, exec3ySalary) {
    // 1. 재직일수 계산
    const joinDate = new Date(join[0], join[1]-1, join[2]);
    const leaveDate = new Date(leave[0], leave[1]-1, leave[2]);
    const days = Math.floor((leaveDate-joinDate)/(1000*60*60*24));
    if(days<0) return {error:'퇴사일이 입사일보다 빠릅니다.'};
    const years = days/365;

    // 평균임금 산정
    let avgSalary = 0;
    if(isExec && exec3ySalary && exec3ySalary>0) {
        avgSalary = exec3ySalary / 1080; // 일당 평균
    } else {
        avgSalary = last1ySalary / 360; // 일당 평균
    }

    let retirePay = avgSalary * 30 * years; // 1년당 30일분
    let limitPay = null;
    if(isExec) {
        // 임원 한도: 평균임금 기반으로 배수 적용
        limitPay = avgSalary * 30 * years * execMultiplier;
        if(retirePay > limitPay) retirePay = limitPay;
    }
    return {retirePay: Math.floor(retirePay), years: years.toFixed(2), avgSalary: Math.floor(avgSalary), limitPay: limitPay?Math.floor(limitPay):null};
}

// 세율표 모달
const showBtn = document.getElementById('showRetireTaxRateBtn');
const modal = document.getElementById('retireTaxRateModal');
const closeBtn = document.getElementById('closeRetireTaxRateModal');

showBtn.onclick = ()=>{ 
    modal.style.display='block';
    modal.style.opacity = '0';
    setTimeout(() => {
        modal.style.transition = 'opacity 0.3s ease';
        modal.style.opacity = '1';
    }, 50);
};

closeBtn.onclick = ()=>{ 
    modal.style.opacity = '0';
    setTimeout(() => {
        modal.style.display='none';
    }, 300);
};

// 모달 배경 클릭시 닫기
modal.onclick = function(e) {
    if(e.target === modal) {
        closeBtn.onclick();
    }
}

// 계산 이벤트
const form = document.getElementById('retirementForm');
form.onsubmit = function(e) {
    e.preventDefault();
    const join = [parseInt(document.getElementById('joinYear').value),parseInt(document.getElementById('joinMonth').value),parseInt(document.getElementById('joinDay').value)];
    const leave = [parseInt(document.getElementById('leaveYear').value),parseInt(document.getElementById('leaveMonth').value),parseInt(document.getElementById('leaveDay').value)];
    const last1ySalary = parseInt(removeComma(document.getElementById('last1ySalary').value))||0;
    const last3ySalary = parseInt(removeComma(document.getElementById('last3ySalary').value))||0;
    const isExec = document.querySelector('input[name="executive"]:checked').value==='yes';
    let execMultiplier = 1;
    if(isExec) execMultiplier = parseFloat(removeComma(document.getElementById('execMultiplier').value))||1;
    const exec3ySalary = parseInt(removeComma(document.getElementById('exec3ySalary').value))||0;
    
    const result = calcRetirementPay(join, leave, last1ySalary, last3ySalary, isExec, execMultiplier, exec3ySalary);
    const box = document.getElementById('retireResult');
    
    if(result.error) {
        box.style.display='block';
        box.innerHTML = `<div style='color:#dc3545;text-align:center;font-weight:600;font-size:1.1em;'>?? ${result.error}</div>`;
        return;
    }
    
    box.style.display='block';
    box.innerHTML =
        `<div style='text-align:center;margin-bottom:20px;'>
            <h4 style='color:#2c3e50;margin-bottom:15px;'>? 퇴직금 계산 결과</h4>
        </div>
        <div style='display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px;'>
            <div style='background:rgba(255,255,255,0.8);padding:15px;border-radius:10px;text-align:center;'>
                <div style='font-size:0.9em;color:#6c757d;margin-bottom:5px;'>재직기간</div>
                <div style='font-size:1.2em;font-weight:600;color:#495057;'>${result.years}년</div>
            </div>
            <div style='background:rgba(255,255,255,0.8);padding:15px;border-radius:10px;text-align:center;'>
                <div style='font-size:0.9em;color:#6c757d;margin-bottom:5px;'>일평균 임금</div>
                <div style='font-size:1.2em;font-weight:600;color:#495057;'>${addComma(result.avgSalary)}원</div>
            </div>
        </div>`+
        (isExec && result.limitPay ? `
        <div style='background:rgba(255,193,7,0.1);border:1px solid rgba(255,193,7,0.3);padding:15px;border-radius:10px;margin-bottom:15px;text-align:center;'>
            <div style='font-size:0.9em;color:#856404;margin-bottom:5px;'>임원 퇴직금 한도 (세법상)</div>
            <div style='font-size:1.1em;font-weight:600;color:#856404;'>${addComma(result.limitPay)}원</div>
        </div>` : '')+
        `<div style='background:rgba(40,167,69,0.1);border:2px solid rgba(40,167,69,0.3);padding:20px;border-radius:12px;text-align:center;'>
            <div style='font-size:1.1em;color:#155724;margin-bottom:8px;'>? 예상 퇴직금</div>
            <div style='font-size:2em;font-weight:700;color:#28a745;'>${addComma(result.retirePay)}원</div>
        </div>`;
        
    // 결과 박스로 스크롤
    box.scrollIntoView({ behavior: 'smooth' });
};
</script>
</body>
</html>
